<!DOCTYPE html>
<html>
<head>
<script src='https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.7.1/p5.min.js'></script>
</head>


<body>

<script>
var hero = new player();
var enemies = [];
var score = 0;
var bestscore = 0;
var gamestarted = false;
var img;

function preload() {
	img = loadImage('https://gippoo.github.io/dodger/nervous-pepe-monkas-twitch-emote.png');
}

function player() {
	this.x = 290;
    	this.y = 350;
    	this.width = 50;
    	this.height = 50;
    	this.speed = 3;
    
    	this.create = function() {
    		fill(0, 255, 0);
    		image(img,this.x,this.y,this.width,this.height);
        	this.bottom = this.y + this.height-15;
    		this.top = this.y+15;
    		this.left = this.x+15;
    		this.right = this.x + this.width-15;
    	}
    
    	this.mright = function() {
    		if ((this.x + this.speed) <= (615 - this.width)) {
        		this.x += this.speed;
        	}
    	}
    	this.mleft = function() {
    		if ((this.x - this.speed) >= -15) {
        		this.x -= this.speed;
        	}
    	}
    	this.mdown = function() {
    		if ((this.y + this.speed) <= (415 - this.height)) {
        		this.y += this.speed;
        	}
    	}
    	this.mup = function() {
    		if ((this.y - this.speed) >= -15) {
        		this.y -= this.speed;
        	}
    	}
}

function enemy() {
	this.speed = Math.random() * 6 + 3
    	this.x = Math.random() * 580;
    	this.y = -300;
    	this.height = Math.floor(Math.random() * 100) + 20;
	this.width = Math.floor(Math.random() * 20) + 10;
    
    	this.create = function() {
    		if (this.y > 400+this.height) {
        		this.speed = Math.random() * 6 + 3;
        		this.x = Math.random() * 600;
    			this.y = -300;
           	 	this.height = Math.floor(Math.random() * 100) + 20;
			this.width = Math.floor(Math.random() * 20) + 10;
        	}
    		fill(148, 216, 134);
    		rect(this.x,this.y,this.width,this.height);
    	}
    
    	this.drop = function() {
    		this.y += this.speed;
    	}
    
    	this.hit = function() {
    		this.bottom = this.y + this.height;
        	this.top = this.y;
        	this.left = this.x;
        	this.right = this.x + this.width;
        
        	if ((hero.bottom > this.top) && (hero.top < this.bottom) && (hero.left < this.right) && (hero.right > this.left)) {
			hero = new player();
            		if (score > bestscore) {
            			bestscore = score;
            		}
            		score = 0;
            		for (let i = 0; i < 15; i++) {
    			enemies[i] = new enemy();
			}
            
            		gamestarted = false;
    		}
        }
}

function setup() {
	var canv = createCanvas(600, 400);
    	background(187, 209, 247);
	canv.parent('gamearea');
    
    	for (let i = 0; i < 15; i++) {
    		enemies[i] = new enemy();
    	}
}


function animate() {
	if (gamestarted == true) {
    	hero.create();
		for (let baddy of enemies) {
    		baddy.create();
        	baddy.drop();
        	baddy.hit();
    	}
    
   		// MOVEMENT
    	if (keyIsDown(RIGHT_ARROW)) {
    		hero.mright();
    	}
    	if (keyIsDown(LEFT_ARROW)) {
    		hero.mleft();
    	}
    	if (keyIsDown(DOWN_ARROW)) {
    		hero.mdown();
    	}
    	if (keyIsDown(UP_ARROW)) {
    		hero.mup();
    	}
    
    	score += 1/30;
    } else {    
    	textSize(32);
    	fill(0);
		text('Press ENTER to start', 145, 200);
    }
    	
}

function draw() {
	background(187, 209, 247);
	animate();
    textSize(16);
    fill(0);
	text('SCORE: ' + score.toFixed(0), 10, 20);
    text('BEST: ' + bestscore.toFixed(0), 10, 40);
}

function keyPressed() {
	if (keyCode === ENTER) {
		gamestarted = true;
	}
}


</script>

	<center><h3>Use the arrow keys to dodge the falling blocks</h3></center>
	<center id='gamearea'></center>

</body>
</html>
